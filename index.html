<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logistics Enterprise System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* --- THEME: INDUSTRIAL CLARITY --- */
        :root {
            --navy: #001F3F;
            --blue-light: #3a506b;
            --light-grey: #F4F4F4;
            --green: #2ECC40;
            --amber: #FFDC00;
            --red: #FF4136;
            --white: #ffffff;
            --border: #e0e0e0;
        }

        body { margin: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: var(--light-grey); color: #333; }
        .hidden { display: none !important; }

        /* --- UI COMPONENTS --- */
        .btn { background-color: var(--navy); color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; display: inline-flex; align-items: center; gap: 6px; transition: 0.2s;}
        .btn:hover { opacity: 0.9; }
        .btn.outline { background: transparent; border: 1px solid var(--navy); color: var(--navy); }
        .btn.small { padding: 4px 8px; font-size: 11px; }
        
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; color: white; text-transform: uppercase; letter-spacing: 0.5px;}
        .badge.green { background-color: var(--green); }
        .badge.amber { background-color: var(--amber); color: black; }
        .badge.red { background-color: var(--red); }
        .badge.blue { background-color: var(--blue-light); }

        /* --- LAYOUT --- */
        #login-screen { height: 100vh; display: flex; justify-content: center; align-items: center; background-color: var(--navy); }
        .login-card { background: white; padding: 40px; border-radius: 8px; width: 350px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .login-card input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }

        #dashboard-screen { display: flex; height: 100vh; }
        
        .sidebar { width: 260px; background-color: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; flex-shrink: 0;}
        .sidebar-header { padding: 25px 20px; background-color: var(--navy); color: white; font-weight: bold; display: flex; align-items: center; gap: 10px;}
        .menu-item { padding: 15px 20px; cursor: pointer; color: #555; display: flex; align-items: center; border-left: 5px solid transparent; transition: all 0.2s; }
        .menu-item i { margin-right: 15px; width: 20px; text-align: center; }
        .menu-item:hover { background-color: #f8f9fa; color: var(--navy); }
        .menu-item.active { background-color: #e9ecef; color: var(--navy); border-left-color: var(--navy); font-weight: bold; }

        .main-content { flex: 1; padding: 20px; overflow-y: hidden; display: flex; flex-direction: column;} /* No scroll on main, scroll inside modules */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-shrink: 0;}

        /* --- DISPATCHER & MAP SPLIT VIEW --- */
        .split-view { display: flex; gap: 20px; height: 100%; overflow: hidden; }
        .fleet-list { flex: 1; background: white; border-radius: 8px; overflow-y: auto; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; flex-direction: column;}
        .map-panel { flex: 2; border-radius: 8px; overflow: hidden; border: 2px solid #ccc; position: relative; }
        #map-container { height: 100%; width: 100%; }

        /* Fleet List Items */
        .fleet-item { padding: 15px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px; cursor: pointer; transition: background 0.2s; }
        .fleet-item:hover { background-color: #f0f4f8; }
        .fleet-item.selected { background-color: #e3f2fd; border-left: 4px solid var(--navy); }
        .driver-avatar { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd; }
        .fleet-details { flex: 1; }
        .fleet-plate { font-weight: bold; font-size: 14px; color: var(--navy); }
        .fleet-sub { font-size: 11px; color: #777; margin-top: 3px; display: flex; gap: 10px;}
        .fleet-actions { display: flex; gap: 5px; }

        /* --- MODAL (Generic) --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 500px; border-radius: 8px; overflow: hidden; animation: slideDown 0.2s; }
        .modal-header { background: var(--navy); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 11px; color: #666; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        
        /* --- HR MODULE STYLES (Kept from previous version) --- */
        .file-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; padding-bottom: 20px;}
        .file-card { background: white; border-top: 4px solid var(--navy); border-radius: 8px; padding: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <i class="fa-solid fa-truck-ramp-box fa-3x" style="color: var(--navy); margin-bottom: 20px;"></i>
            <h2 style="color: var(--navy); margin-top: 0;">LOGISTICS ENTERPRISE</h2>
            <p style="color: #666; font-size: 14px;">Fleet Command V7.0</p>
            <input type="text" placeholder="User ID" value="ADMIN-01">
            <input type="password" placeholder="Password" value="password">
            <button class="btn" style="width: 100%; justify-content: center; padding: 12px;" onclick="login()">SECURE LOGIN</button>
        </div>
    </div>

    <div id="dashboard-screen" class="hidden">
        
        <div class="sidebar">
            <div class="sidebar-header"><i class="fa-solid fa-layer-group"></i> COMMAND CENTER</div>
            <div class="menu-item active" onclick="showView('dispatch-module', this)"><i class="fa-solid fa-map-location-dot"></i> Dispatch & Fleet</div>
            <div class="menu-item" onclick="showView('hr-module', this)"><i class="fa-solid fa-users"></i> HR (201 Files)</div>
            <div class="menu-item" onclick="showView('inventory-module', this)"><i class="fa-solid fa-boxes-stacked"></i> Inventory</div>
            <div style="margin-top: auto;"></div>
            <div class="menu-item" onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i> Logout</div>
        </div>

        <div class="main-content">
            
            <div id="dispatch-module" class="view-section" style="height: 100%; display: flex; flex-direction: column;">
                <div class="header">
                    <h1 style="color: var(--navy); margin: 0;">Fleet Command</h1>
                    
                    <div style="display: flex; gap: 15px;">
                        <div style="background: white; padding: 5px 15px; border-radius: 4px; border-left: 3px solid var(--green); box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                            <span style="font-size: 10px; color: #888;">AVAILABLE</span><br><b>4 Vehicles</b>
                        </div>
                        <div style="background: white; padding: 5px 15px; border-radius: 4px; border-left: 3px solid var(--blue-light); box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                            <span style="font-size: 10px; color: #888;">ON ROUTE</span><br><b>2 Vehicles</b>
                        </div>
                        <div style="background: white; padding: 5px 15px; border-radius: 4px; border-left: 3px solid var(--amber); box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                            <span style="font-size: 10px; color: #888;">MAINTENANCE</span><br><b>1 Vehicle</b>
                        </div>
                    </div>
                </div>

                <div class="split-view">
                    <div class="fleet-list">
                        <div style="padding: 15px; border-bottom: 1px solid #eee; background: #fafafa;">
                            <b style="color: var(--navy);">Active Fleet Roster</b>
                        </div>
                        <div id="fleet-list-container">
                            </div>
                    </div>

                    <div class="map-panel">
                        <div id="map-container"></div>
                        <div style="position: absolute; bottom: 10px; left: 10px; background: rgba(255,255,255,0.9); padding: 10px; border-radius: 4px; font-size: 11px; z-index: 999; border: 1px solid #ccc;">
                            <i class="fa-solid fa-circle" style="color: var(--blue-light);"></i> Active Route Path<br>
                            <i class="fa-solid fa-location-dot" style="color: var(--navy);"></i> Vehicle Position<br>
                            <i class="fa-solid fa-flag-checkered" style="color: black;"></i> Destination
                        </div>
                    </div>
                </div>
            </div>

            <div id="hr-module" class="view-section hidden" style="overflow-y: auto;">
                <div class="header">
                    <h1 style="color: var(--navy); margin: 0;">201 Files (HR)</h1>
                    <button class="btn"><i class="fa-solid fa-plus"></i> New Hire</button>
                </div>
                <div class="file-grid">
                    <div class="file-card">
                        <div style="text-align: center;">
                            <img src="https://i.pravatar.cc/150?img=11" style="width:80px; height:80px; border-radius:50%; margin-bottom:10px;">
                            <h3 style="margin:0; color:var(--navy);">John Doe</h3>
                            <p style="margin:0; color:#777; font-size:12px;">Senior Driver</p>
                            <br>
                            <button class="btn outline small" style="width:100%; justify-content:center;">View 201 File</button>
                        </div>
                    </div>
                    <div class="file-card">
                        <div style="text-align: center;">
                            <img src="https://i.pravatar.cc/150?img=3" style="width:80px; height:80px; border-radius:50%; margin-bottom:10px;">
                            <h3 style="margin:0; color:var(--navy);">Mike Santos</h3>
                            <p style="margin:0; color:#777; font-size:12px;">Forklift Operator</p>
                            <br>
                            <button class="btn outline small" style="width:100%; justify-content:center;">View 201 File</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="inventory-module" class="view-section hidden">
                <div class="header"><h1>Inventory System</h1></div>
                <p>Inventory Module Content...</p>
            </div>

        </div>
    </div>

    <div id="vehicle-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <span><i class="fa-solid fa-truck-front"></i> Vehicle Profile</span>
                <button onclick="closeModal()" style="background:none; border:none; color:white; font-size:18px; cursor:pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-vehicle-id">
                <div class="form-group">
                    <label>Assigned Driver</label>
                    <input type="text" id="edit-driver" readonly style="background:#eee;">
                </div>
                <div class="form-group">
                    <label>Vehicle Plate</label>
                    <input type="text" id="edit-plate" readonly style="background:#eee;">
                </div>
                <div class="form-group">
                    <label>Current Status</label>
                    <select id="edit-status">
                        <option value="Available">Available</option>
                        <option value="On Route">On Route</option>
                        <option value="Maintenance">Maintenance</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Odometer (Mileage - km)</label>
                    <input type="number" id="edit-mileage">
                </div>
                <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
                    <button class="btn outline" onclick="closeModal()">Cancel</button>
                    <button class="btn" onclick="saveVehicleChanges()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // --- DATA: FLEET ---
        // QC Coordinates: 14.6450, 121.0350
        const fleetData = [
            { 
                id: 1, driver: "John Doe", img: "https://i.pravatar.cc/150?img=11", 
                plate: "NCA-1234", type: "Isuzu Giga", status: "On Route", 
                mileage: 45200, 
                currentPos: [14.6507, 121.0285], // SM North
                startPos: [14.6760, 121.0437], // Tandang Sora
                endPos: [14.6091, 120.9814] // Manila Port
            },
            { 
                id: 2, driver: "Rico Jose", img: "https://i.pravatar.cc/150?img=13", 
                plate: "XLM-992", type: "L300 Van", status: "Available", 
                mileage: 12500, 
                currentPos: [14.6415, 121.0423], // QC Circle
                startPos: null, endPos: null
            },
            { 
                id: 3, driver: "Mike Santos", img: "https://i.pravatar.cc/150?img=3", 
                plate: "RTY-551", type: "Wing Van", status: "Maintenance", 
                mileage: 89000, 
                currentPos: [14.6178, 121.0572], // Cubao Shop
                startPos: null, endPos: null
            },
            { 
                id: 4, driver: "Alex Lim", img: "https://i.pravatar.cc/150?img=68", 
                plate: "ABC-111", type: "Canter", status: "On Route", 
                mileage: 33100, 
                currentPos: [14.5844, 121.0609], // Ortigas
                startPos: [14.6178, 121.0572], // Cubao
                endPos: [14.5547, 121.0244] // Makati
            }
        ];

        let map;
        let markers = {};
        let routeLine = null;

        // --- RENDER FLEET LIST ---
        function renderFleetList() {
            const container = document.getElementById('fleet-list-container');
            container.innerHTML = '';

            fleetData.forEach(vehicle => {
                let badgeColor = 'green';
                if(vehicle.status === 'On Route') badgeColor = 'blue';
                if(vehicle.status === 'Maintenance') badgeColor = 'amber';

                const div = document.createElement('div');
                div.className = 'fleet-item';
                div.onclick = () => focusVehicle(vehicle.id);
                div.innerHTML = `
                    <img src="${vehicle.img}" class="driver-avatar">
                    <div class="fleet-details">
                        <div class="fleet-plate">${vehicle.plate} <span class="badge ${badgeColor}">${vehicle.status}</span></div>
                        <div class="fleet-sub">
                            <span><i class="fa-solid fa-user"></i> ${vehicle.driver}</span>
                            <span><i class="fa-solid fa-gauge"></i> ${vehicle.mileage.toLocaleString()} km</span>
                        </div>
                        <div class="fleet-sub" style="margin-top:2px;">
                            <span><i class="fa-solid fa-truck"></i> ${vehicle.type}</span>
                        </div>
                    </div>
                    <div class="fleet-actions">
                        <button class="btn outline small" onclick="event.stopPropagation(); editProfile(${vehicle.id})">Edit</button>
                        ${vehicle.status === 'On Route' ? '<button class="btn small"><i class="fa-solid fa-crosshairs"></i> Track</button>' : ''}
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // --- MAP LOGIC ---
        function initMap() {
            if (map) return;
            map = L.map('map-container').setView([14.6450, 121.0350], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

            // Add Markers for all cars initially
            fleetData.forEach(v => {
                const marker = L.marker(v.currentPos).addTo(map);
                marker.bindPopup(`<b>${v.plate}</b><br>${v.driver}`);
                markers[v.id] = marker;
            });
        }

        function focusVehicle(id) {
            const vehicle = fleetData.find(v => v.id === id);
            if(!vehicle) return;

            // Highlight List Item
            document.querySelectorAll('.fleet-item').forEach(el => el.classList.remove('selected'));
            // (In a real app, we would target the specific element better, simplified here)

            // Map Actions
            if(map) {
                // 1. Remove old lines
                if(routeLine) map.removeLayer(routeLine);

                // 2. Pan to Vehicle
                map.setView(vehicle.currentPos, 14);
                markers[vehicle.id].openPopup();

                // 3. Draw Route if Active
                if(vehicle.status === 'On Route' && vehicle.startPos && vehicle.endPos) {
                    const latlngs = [
                        vehicle.startPos,
                        vehicle.currentPos,
                        vehicle.endPos
                    ];
                    
                    // Draw Line
                    routeLine = L.polyline(latlngs, {color: '#3a506b', weight: 4, opacity: 0.7, dashArray: '10, 10'}).addTo(map);
                    
                    // Add Start/End Markers
                    L.marker(vehicle.startPos, {icon: createIcon('green')}).addTo(map).bindPopup("Start Point");
                    L.marker(vehicle.endPos, {icon: createIcon('red')}).addTo(map).bindPopup("Destination");
                    
                    map.fitBounds(routeLine.getBounds(), {padding: [50,50]});
                }
            }
        }

        function createIcon(color) {
            return L.divIcon({
                className: 'custom-icon',
                html: `<i class="fa-solid fa-flag" style="color:${color}; font-size:20px; text-shadow: 2px 2px 2px white;"></i>`,
                iconSize: [20, 20],
                iconAnchor: [10, 20]
            });
        }

        // --- EDIT PROFILE LOGIC ---
        function editProfile(id) {
            const vehicle = fleetData.find(v => v.id === id);
            document.getElementById('edit-vehicle-id').value = vehicle.id;
            document.getElementById('edit-driver').value = vehicle.driver;
            document.getElementById('edit-plate').value = vehicle.plate;
            document.getElementById('edit-mileage').value = vehicle.mileage;
            document.getElementById('edit-status').value = vehicle.status;
            
            document.getElementById('vehicle-modal').classList.remove('hidden');
        }

        function saveVehicleChanges() {
            const id = parseInt(document.getElementById('edit-vehicle-id').value);
            const vehicle = fleetData.find(v => v.id === id);
            
            vehicle.mileage = parseInt(document.getElementById('edit-mileage').value);
            vehicle.status = document.getElementById('edit-status').value;
            
            closeModal();
            renderFleetList(); // Refresh UI
            
            // Re-render map marker icon color if we were fancy, but text update is enough for prototype
            alert(`Profile for ${vehicle.plate} updated successfully!`);
        }

        function closeModal() {
            document.getElementById('vehicle-modal').classList.add('hidden');
        }

        // --- NAVIGATION ---
        function login() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('dashboard-screen').classList.remove('hidden');
            renderFleetList();
            setTimeout(() => { initMap(); map.invalidateSize(); }, 100);
        }

        function logout() {
            document.getElementById('dashboard-screen').classList.add('hidden');
            document.getElementById('login-screen').style.display = 'flex';
        }

        function showView(viewId, element) {
            document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
            
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            element.classList.add('active');

            if(viewId === 'dispatch-module') {
                setTimeout(() => { if(map) map.invalidateSize(); }, 100);
            }
        }
    </script>
</body>
</html>
